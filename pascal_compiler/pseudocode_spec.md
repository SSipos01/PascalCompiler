# Pseudocode Specification

This document defines the specification for the pseudocode generated by the Object Pascal compiler. The pseudocode is designed to be similar to a macro assembler, with a 32-bit address range.

## General Syntax

- Each line contains a single instruction.
- Instructions consist of an opcode followed by zero or more operands.
- Operands are separated by commas.
- Comments begin with a semicolon (`;`).

Example:
```
; This is a comment
MOV R1, 5       ; Move the value 5 into register R1
ADD R3, R1, R2  ; R3 = R1 + R2
```

## Data Declaration

Variables are declared in a data segment. The `VAR` pseudo-instruction is used for this purpose.

- `VAR <name>, <type>, <size_in_bytes>`

Example:
```
.DATA
VAR my_var, integer, 4
VAR my_string, string, 256
```

## Registers

The pseudocode machine has 16 general-purpose 32-bit registers: `R0` through `R15`.

## Addressing Modes

- **Immediate**: A constant value, prefixed with `#`. Example: `#123`.
- **Direct**: A memory location, referenced by a variable name. Example: `my_var`.
- **Register**: A direct register access. Example: `R1`.

## Instruction Set

### Data Transfer
- `MOV dst, src`: Move data from `src` to `dst`.
- `PUSH src`: Push `src` onto the stack.
- `POP dst`: Pop the top of the stack into `dst`.

### Arithmetic
- `ADD dst, src1, src2`: `dst = src1 + src2`
- `SUB dst, src1, src2`: `dst = src1 - src2`
- `MUL dst, src1, src2`: `dst = src1 * src2`
- `DIV dst, src1, src2`: `dst = src1 / src2`

### Control Flow
- `JMP label`: Unconditional jump to `label`.
- `CMP op1, op2`: Compare `op1` and `op2` and set flags.
- `JE label`: Jump to `label` if equal.
- `JNE label`: Jump to `label` if not equal.
- `JG label`: Jump to `label` if greater.
- `JGE label`: Jump to `label` if greater or equal.
- `JL label`: Jump to `label` if less.
- `JLE label`: Jump to `label` if less or equal.
- `CALL label`: Call a subroutine at `label`.
- `RET`: Return from a subroutine.

### System Calls (I/O and File Handling)

The `SYSCALL` instruction is used for interacting with the system. The specific operation is determined by the value in register `R0`.

- `SYSCALL <call_number>`

| Call Number | Operation | `R1` | `R2` | `R3` |
|---|---|---|---|---|
| 1 | `read_int` | address to store int | - | - |
| 2 | `write_int` | integer value to write | - | - |
| 3 | `read_str` | address of buffer | max length | - |
| 4 | `write_str` | address of string | - | - |
| 10 | `file_assign`| file handle address | string with filename | - |
| 11 | `file_reset` | file handle address | record size | - |
| 12 | `file_rewrite`| file handle address | record size | - |
| 13 | `file_close` | file handle address | - | - |
| 14 | `file_read` | file handle address | buffer address | - |
| 15 | `file_write` | file handle address | buffer address | - |


### Program Termination
- `HALT`: Stop program execution.

### Assembly Block
- `ASM_BLOCK`: Marks the beginning of an inline assembly block.
- `END_ASM_BLOCK`: Marks the end of an inline assembly block.
The content between these will be passed through as-is.
